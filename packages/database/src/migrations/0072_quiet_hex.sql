DROP MATERIALIZED VIEW "public"."account_materialized_view";--> statement-breakpoint
DROP MATERIALIZED VIEW "public"."journal_extended_view";--> statement-breakpoint
DROP VIEW "public"."account_view";--> statement-breakpoint
DROP VIEW "public"."journal_view";--> statement-breakpoint
ALTER TABLE "account" ADD COLUMN "is_catchall" boolean DEFAULT false NOT NULL;--> statement-breakpoint
CREATE VIEW "public"."account_view" AS (with "filessq" as (select "associated_info"."account_id", count("files"."id") as "file_count" from "files" left join "associated_info" on "files"."associated_info_id" = "associated_info"."id" where "associated_info"."account_id" is not null group by "associated_info"."account_id"), "notessq" as (select "associated_info"."account_id", count("notes"."id") as "note_count" from "notes" left join "associated_info" on "notes"."associated_info_id" = "associated_info"."id" where "associated_info"."account_id" is not null group by "associated_info"."account_id"), "reminderssq" as (select "associated_info"."account_id", count("notes"."id") as "reminder_count" from "notes" left join "associated_info" on "notes"."associated_info_id" = "associated_info"."id" where ("notes"."type" = 'reminder' and "associated_info"."account_id" is not null) group by "associated_info"."account_id") select "account"."id", "account"."import_id", "account"."account_import_detail_id", "account"."title", "account"."type", "account"."is_cash", "account"."is_net_worth", "account"."is_catchall", "account"."account_group", "account"."account_group_2", "account"."account_group_3", "account"."account_group_combined", "account"."account_title_combined", "account"."start_date", "account"."end_date", "account"."status", "account"."active", "account"."disabled", "account"."allow_update", "account"."created_at", "account"."updated_at", sum("journal_entry"."amount") as "sum", count("journal_entry"."id") as "count", min("journal_entry"."date") as "firstDate", max("journal_entry"."date") as "lastDate", max("note_count") as "note_count", max("reminder_count") as "reminder_count", max("file_count") as "file_count" from "account" left join "journal_entry" on "account"."id" = "journal_entry"."account_id" left join "import" on "journal_entry"."import_id" = "import"."id" left join "filessq" on "account"."id" = "filessq"."account_id" left join "notessq" on "account"."id" = "notessq"."account_id" left join "reminderssq" on "account"."id" = "reminderssq"."account_id" group by "account"."id");--> statement-breakpoint
CREATE VIEW "public"."journal_view" AS (with "filessq" as (select "associated_info"."transaction_id", count("files"."id") as "file_count" from "files" left join "associated_info" on "files"."associated_info_id" = "associated_info"."id" where "associated_info"."transaction_id" is not null group by "associated_info"."transaction_id"), "notessq" as (select "associated_info"."transaction_id", count("notes"."id") as "note_count" from "notes" left join "associated_info" on "notes"."associated_info_id" = "associated_info"."id" where "associated_info"."transaction_id" is not null group by "associated_info"."transaction_id"), "reminderssq" as (select "associated_info"."transaction_id", count("notes"."id") as "reminder_count" from "notes" left join "associated_info" on "notes"."associated_info_id" = "associated_info"."id" where ("notes"."type" = 'reminder' and "associated_info"."transaction_id" is not null) group by "associated_info"."transaction_id") select "journal_entry"."id", "journal_entry"."import_id", "journal_entry"."import_detail_id", "journal_entry"."unique_id", "journal_entry"."amount", "transaction"."id" as "transaction_id", "journal_entry"."description", "journal_entry"."date", "journal_entry"."date_text", "journal_entry"."tag_id", "journal_entry"."bill_id", "journal_entry"."budget_id", "journal_entry"."category_id", "journal_entry"."account_id", "journal_entry"."year_month_day", "journal_entry"."year_week", "journal_entry"."year_month", "journal_entry"."year_quarter", "journal_entry"."year", "journal_entry"."linked", "journal_entry"."reconciled", "journal_entry"."data_checked", "journal_entry"."complete", "journal_entry"."llm_review_status", "journal_entry"."transfer", "journal_entry"."created_at", "journal_entry"."updated_at", "account"."title", "account"."type", "account"."is_cash", "account"."is_net_worth", "account"."is_catchall", "account"."account_group", "account"."account_group_2", "account"."account_group_3", "account"."account_group_combined", "account"."account_title_combined", "account"."start_date", "account"."end_date", "account"."status" as "account_status", "account"."active" as "account_active", "account"."disabled" as "account_disabled", "account"."allow_update" as "account_allow_update", "bill"."title" as "bill_title", "bill"."status" as "bill_status", "bill"."active" as "bill_active", "bill"."disabled" as "bill_disabled", "bill"."allow_update" as "bill_allow_update", "budget"."title" as "budget_title", "budget"."status" as "budget_status", "budget"."active" as "budget_active", "budget"."disabled" as "budget_disabled", "budget"."allow_update" as "budget_allow_update", "category"."title" as "category_title", "category"."group" as "category_group", "category"."single" as "category_single", "category"."status" as "category_status", "category"."active" as "category_active", "category"."disabled" as "category_disabled", "category"."allow_update" as "category_allow_update", "tag"."title" as "tag_title", "tag"."group" as "tag_group", "tag"."single" as "tag_single", "tag"."status" as "tag_status", "tag"."active" as "tag_active", "tag"."disabled" as "tag_disabled", "tag"."allow_update" as "tag_allow_update", "import"."title" as "import_title", "note_count", "reminder_count", "file_count", true as "all" from "journal_entry" left join "transaction" on "journal_entry"."transaction_id" = "transaction"."id" left join "account" on "journal_entry"."account_id" = "account"."id" left join "bill" on "journal_entry"."bill_id" = "bill"."id" left join "budget" on "journal_entry"."budget_id" = "budget"."id" left join "category" on "journal_entry"."category_id" = "category"."id" left join "tag" on "journal_entry"."tag_id" = "tag"."id" left join "import" on "journal_entry"."import_id" = "import"."id" left join "filessq" on "journal_entry"."transaction_id" = "filessq"."transaction_id" left join "notessq" on "journal_entry"."transaction_id" = "notessq"."transaction_id" left join "reminderssq" on "journal_entry"."transaction_id" = "reminderssq"."transaction_id");--> statement-breakpoint
CREATE MATERIALIZED VIEW "public"."account_materialized_view" AS (select "id", "import_id", "account_import_detail_id", "title", "type", "is_cash", "is_net_worth", "is_catchall", "account_group", "account_group_2", "account_group_3", "account_group_combined", "account_title_combined", "start_date", "end_date", "status", "active", "disabled", "allow_update", "created_at", "updated_at", "sum", "count", "firstDate", "lastDate", "note_count", "reminder_count", "file_count" from "account_view");--> statement-breakpoint
CREATE MATERIALIZED VIEW "public"."journal_extended_view" AS (select "id", "import_id", "import_detail_id", "unique_id", "amount", "transaction_id", "description", "date", "date_text", "tag_id", "bill_id", "budget_id", "category_id", "account_id", "year_month_day", "year_week", "year_month", "year_quarter", "year", "linked", "reconciled", "data_checked", "complete", "llm_review_status", "transfer", "created_at", "updated_at", "title", "type", "is_cash", "is_net_worth", "is_catchall", "account_group", "account_group_2", "account_group_3", "account_group_combined", "account_title_combined", "start_date", "end_date", "account_status", "account_active", "account_disabled", "account_allow_update", "bill_title", "bill_status", "bill_active", "bill_disabled", "bill_allow_update", "budget_title", "budget_status", "budget_active", "budget_disabled", "budget_allow_update", "category_title", "category_group", "category_single", "category_status", "category_active", "category_disabled", "category_allow_update", "tag_title", "tag_group", "tag_single", "tag_status", "tag_active", "tag_disabled", "tag_allow_update", "import_title", "note_count", "reminder_count", "file_count", "all" from "journal_view");